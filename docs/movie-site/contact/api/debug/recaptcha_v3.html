<html lang="ja">
<head>
<meta charset="utf-8" />
<title>reCAPTCHA v3 Sample 3</title>
</head>
<body>
  <form id="rc_form" method="post">
    <button type="submit">送信</button>
  </form>
<script src="https://www.google.com/recaptcha/api.js?render=6LfbJN4ZAAAAAIo5lhFqWWPt10e0uEVkETiqkk3T"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script><!-- jQuery の読み込み -->  
<script>
jQuery(function($){
  //フォーム要素に submit イベントを設定
  $('#rc_form').submit(function(event) {
    //デフォルトの動作（送信）を停止
    event.preventDefault();
    //トークンを取得
    grecaptcha.ready(function() {
      grecaptcha.execute('6LfbJN4ZAAAAAIo5lhFqWWPt10e0uEVkETiqkk3T', {action: 'homepage'}).then(function(token) {
        //input 要素を生成して値にトークンを設定
        $('#rc_form').prepend('<input type="hidden" name="g-recaptcha-response" value="' + token + '">');
        //input 要素を生成して値にアクション名を設定
        //$('#rc_form').prepend('<input type="hidden" name="action" value="homepage">');
        //unbind で一度 submit のイベントハンドラを削除してから submit() を実行
        //$('#rc_form').unbind('submit').submit();
        console.log(token);
      });;
    });
  });
})
</script>
</body>
</html>
